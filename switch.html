<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="css/switch.css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.4/lodash.min.js"></script>

    <script src="js/vue.js"></script>
    <meta charset="UTF-8">
    <title>vue-switch</title>
</head>
<body>
<div class="container-fluid">
    <h1 class="text-center">vue-switch</h1>
    <ul id="nav" role="tablist" class="nav nav-tabs">
        <li v-for="(list,index) in lists" role="presentation" :class="list.classObj" @click="active(index)">
            <a href="#">{{list.text}}</a>
        </li>
    </ul>
    <!-- Tab panes storage -->
    <div class="tab-content">
        <div id="storage" role="tabpanel" class="tab-pane container ">
            <div class="row">
                <div class="col-md-5">
                    <my-input :value="input" @input="input = arguments[0]"></my-input>
                </div>
                <div class="col-md-3">
                    <select-unit :units="units" :value="now" @change="now = arguments[0]"></select-unit>
                </div>
                <div class="col-md-1">
                    <reversal v-on:click="reversal"></reversal>
                </div>
                <div class="col-md-3">
                    <select-unit :units="[{value:'all',text:'全部'}].concat(units)" :value="future"
                                 @change="future = arguments[0]"></select-unit>
                </div>
            </div>
            <div class="row">
                <div v-if="display.clear" class="col-md-12">
                    <detail :detail="display.clearData"></detail>
                </div>
                <div v-if="display.all" class="col-md-6">
                    <table style="width: 80%;margin: auto" class="table">
                        <tbody>
                        <tr>
                            <td>{{bit}}</td>
                            <td>比特(bit)</td>
                        </tr>
                        <tr>
                            <td>{{b}}</td>
                            <td>字节(b)</td>
                        </tr>
                        <tr>
                            <td>{{kb}}</td>
                            <td>千字节(kb)</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div v-if="display.all" class="col-md-6">
                    <table style="width: 80%;margin: auto" class="table">
                        <tbody>
                        <tr>
                            <td>{{mb}}</td>
                            <td>兆字节(mb)</td>
                        </tr>
                        <tr>
                            <td>{{gb}}</td>
                            <td>千兆字节(gb)</td>
                        </tr>
                        <tr>
                            <td>{{tb}}</td>
                            <td>太字节(tb)</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <unit content="国际单位：字节(b)"></unit>
            </div>
        </div>
        <div id="length" role="tabpanel" class="tab-pane container active">
            <div class="row">
                <div class="col-md-5">
                    <my-input :value="input" @input="input = arguments[0]"></my-input>
                </div>
                <div class="col-md-3">
                    <select-group-unit :units="units" :value="now" @change="now = arguments[0]"></select-group-unit>
                </div>
                <div class="col-md-1">
                    <reversal v-on:click="reversal"></reversal>
                </div>
                <div class="col-md-3">
                    <select-group-unit :units="[{name:'全部',values:[{value:'all',text:'全部'}]}].concat(units)"
                                       :value="future"
                                       @change="future = arguments[0]"></select-group-unit>
                </div>
            </div>
            <div class="row">
                <div v-if="display.all" class="col-md-6">
                    <h3>公制</h3>
                    <result-list :results="results.metric"></result-list>
                    <h3>航海</h3>
                    <result-list :results="results.navigation"></result-list>
                    <h3>天文</h3>
                    <result-list :results="results.astronomy"></result-list>
                </div>
                <div v-if="display.all" class="col-md-6">
                    <h3>中国(古制)</h3>
                    <result-list :results="results.cn"></result-list>
                    <h3>英/美</h3>
                    <result-list :results="results.en_us"></result-list>
                </div>
                <div v-if="display.clear" class="col-md-12">
                    <detail :detail="display.clearData"></detail>
                </div>
                <unit content="国际单位：米(m)"></unit>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane container">c</div>
        <div role="tabpanel" class="tab-pane container">...</div>
    </div>
</div>
</div>
</body>

<script>

    Vue.component('my-input', {
        template: '' +
        '<input ref="input" :value="value" @input="syncParent($event.target.value)" class="form-control text-right" placeholder="请输入数值">',
        props: ['value'],
        methods: {
            syncParent: function (value) {
                var formattedValue = value
                // 删除两侧的空格符
                    .trim()
                    // 保留 2 位小数
                    .slice(
                        0,
                        value.indexOf('.') === -1
                            ? value.length
                            : value.indexOf('.') + 3
                    );
                // 如果值尚不合规，则手动覆盖为合规的值
                if (formattedValue !== value) {
                    this.$refs.input.value = formattedValue
                }
                // 通过 input 事件带出数值
                this.$emit('input', Number(formattedValue))
            }
        }
    });

    Vue.component('unit', {
        template:
        '                <div class="row">\n' +
        '                    <div class="col-md-12" style="margin-top: 10px;color: #999;">\n' +
        '                        <p class="text-right">{{content}}</p>' +
        '                    </div>\n' +
        '                </div>',
        props: ['content']
    });

    Vue.component('detail', {
        template: "<h1 style=\"border-bottom: 1px solid #ebebeb;\" class=\"text-center\">{{detail}}</h1>",
        props: ['detail']
    });

    Vue.component('reversal', {
        template: "" +
        "               <button type=\"button\" class=\"btn btn-default\" aria-label=\"Left Align\" @click='reversal'>\n" +
        "                   <span class=\"glyphicon glyphicon-transfer\" aria-hidden=\"true\"></span>\n" +
        "               </button>\n",
        methods: {
            reversal: function () {
                this.$emit('click')
            }
        }
    })

    Vue.component('select-unit', {
        template: "                    <select class=\"form-control\" :value='value' @change='change($event.target.value)'>\n" +
        "                        <option :value=\"unit.value\" v-for=\"(unit,index) in units\">{{unit.text}}</option>\n" +
        "                    </select>",
        props: ['units', 'value'],
        methods: {
            change: function (value) {
                this.$emit('change', value)
            }
        }
    });

    Vue.component('select-group-unit', {
        template:
        "<select class=\"form-control\" :value='value' @change='change($event.target.value)'>\n" +
        "<optgroup :label='unit.name' v-for='unit in units'>" +
        "<option :value=\"value.value\" v-for=\"value in unit.values\">{{value.text}}</option>\n" +
        "</optgroup>" +
        "</select>",
        props: ['units', 'value'],
        methods: {
            change: function (value) {
                this.$emit('change', value)
            }
        }
    });

    Vue.component('result-list', {
        template:
        "<ul class='list-group'>" +
        "<li class='list-group-item' style='height: 45px;' v-for='result in results'>" +
        "<p style='float: left;display:inline-block;'>{{result.unit}}</p>" +
        "<p style='float:right;display: inline-block;'>{{result.value}}</p>" +
        "</li>" +
        "</ul>",
        props: ['results']
    });

    var nav = new Vue({
        el: "#nav",
        data: {
            lists: [
                {text: '存储单位', classObj: {active: false}},
                {text: '长度', classObj: {active: true}},
                {text: '面积', classObj: {active: false}}
            ],
            lastActive: 0
        },
        methods: {
            active: function (even) {
                this.lists[this.lastActive].classObj.active = false;
                $(".tab-content").find('.tab-pane.container:eq(' + this.lastActive + ')').attr('class', "tab-pane container");
                this.lists[even].classObj.active = true;
                $(".tab-content").find('.tab-pane.container:eq(' + even + ')').attr('class', "tab-pane container active");
                this.lastActive = even;
            }
        }
    });

    var storage = new Vue({
        el: "#storage",
        data: {
            units: [
                {value: 'bit', text: '比特'},
                {value: 'b', text: '字节'},
                {value: 'kb', text: '千字节'},
                {value: 'mb', text: '兆字节'},
                {value: 'gb', text: '千兆字节'},
                {value: 'tb', text: '钛兆字节'}
            ],
            display: {
                all: true,
                clear: false,
                clearData: null
            },
            input: 0,
            now: 'b',
            future: 'all',
            b: 0,
            bit: 0,
            kb: 0,
            mb: 0,
            gb: 0,
            tb: 0
        },
        watch: {
            input: function () {
                this.translate()
            },
            now: function () {
                this.translate()
            },
            future: function () {
                if (this.future === 'all') {
                    this.display.clear = false;
                    this.display.all = true;
                } else {
                    this.display.clearData = this.input + this.now + '=' + this[this.future] + this.future;
                    this.display.clear = true;
                    this.display.all = false;
                }
            }
        },
        methods: {
            translate: function () {
                switch (this.now) {
                    case 'bit':
                        this.b = this.input / Math.pow(2, 3);
                        this.bit = this.input;
                        this.kb = this.input / Math.pow(2, 3) / Math.pow(2, 10);
                        this.mb = this.input / Math.pow(2, 3) / Math.pow(2, 20);
                        this.gb = this.input / Math.pow(2, 3) / Math.pow(2, 30);
                        this.tb = this.input / Math.pow(2, 3) / Math.pow(2, 40);
                        break;
                    case 'b':
                        this.b = this.input;
                        this.bit = this.input * Math.pow(2, 3);
                        this.kb = this.input / Math.pow(2, 10);
                        this.mb = this.input / Math.pow(2, 20);
                        this.gb = this.input / Math.pow(2, 30);
                        this.tb = this.input / Math.pow(2, 40);
                        break;
                    case 'kb':
                        this.b = this.input * Math.pow(2, 10);
                        this.bit = this.input * Math.pow(2, 3) * Math.pow(2, 10);
                        this.kb = this.input;
                        this.mb = this.input / Math.pow(2, 10);
                        this.gb = this.input / Math.pow(2, 20);
                        this.tb = this.input / Math.pow(2, 30);
                        break;
                    case 'mb':
                        this.b = this.input * Math.pow(2, 20);
                        this.bit = this.input * Math.pow(2, 3) * Math.pow(2, 20);
                        this.mb = this.input;
                        this.kb = this.input * Math.pow(2, 10);
                        this.gb = this.input / Math.pow(2, 10);
                        this.tb = this.input / Math.pow(2, 20);
                        break;
                    case 'gb':
                        this.bit = this.input * Math.pow(2, 3) * Math.pow(2, 30);
                        this.b = this.input * Math.pow(2, 30);
                        this.kb = this.input * Math.pow(2, 20);
                        this.mb = this.input * Math.pow(2, 10);
                        this.gb = this.input;
                        this.tb = this.input / Math.pow(2, 10);
                        break;
                    case 'tb':
                        this.bit = this.input * Math.pow(2, 3) * Math.pow(2, 40);
                        this.b = this.input * Math.pow(2, 40);
                        this.kb = this.input * Math.pow(2, 30);
                        this.mb = this.input * Math.pow(2, 20);
                        this.gb = this.input * Math.pow(2, 10);
                        this.tb = this.input;
                        break;
                }
                if (this.future !== 'all') {
                    this.display.clearData = this.input + this.now + '=' + this[this.future] + this.future
                }
            },
            reversal: function () {
                if (this.future !== 'all') {
                    var now = this.now;
                    this.now = this.future;
                    this.future = now;
                }
            }
        }
    });

    var length = new Vue({
        el: "#length",
        data: {
            units: [
                {
                    key: 'metric',
                    name: '公制',
                    values: [
                        {value: 'mm', text: '毫米'},
                        {value: 'cm', text: '厘米'},
                        {value: 'dm', text: '分米'},
                        {value: 'm', text: '米'},
                        {value: 'km', text: '千米'}
                    ]
                },
                {
                    key: 'cn',
                    name: '中国',
                    values: [
                        {value: 'cn_hao', text: '毫'},
                        {value: 'cn_li', text: '厘'},
                        {value: 'cn_fen', text: '分'},
                        {value: 'cn_cun', text: '寸'},
                        {value: 'cn_chi', text: '尺'},
                        {value: 'cn_zhang', text: '丈'},
                        {value: 'cn_Li', text: '里'}
                    ]
                },
                {
                    key: 'navigation',
                    name: '航海',
                    values: [
                        {value: 'nautical', text: '海里'},
                        {value: 'xun', text: '英寻'}
                    ]
                },
                {
                    key: 'astronomy',
                    name: '天文',
                    values: [
                        {value: 'pc', text: '秒差距 (pc)1'},
                        {value: 'light_year', text: '光年'},
                        {value: 'ae', text: '天文单位 (AE)'},
                        {value: 'light_second', text: '光秒'},
                        {value: 'light_minute', text: '光分'}
                    ]
                },
                {
                    key: 'en_us',
                    name: '英／美',
                    values: [
                        {value: 'in', text: '英寸'},
                        {value: 'ft', text: '英尺'},
                        {value: 'mi', text: '英里'},
                        {value: 'yd', text: '码'}
                    ]
                }
            ],
            display: {
                all: true,
                clear: false,
                clearData: null
            },
            input: 0,
            now: 'cm',
            future: 'all',
            results: {
                metric: [
                    {unit: 'mm(毫米)', key: 'mm', value: 0, formula: 1},
                    {unit: 'cm(厘米)', key: 'cm', value: 0, formula: 10},
                    {unit: 'dm(分米)', key: 'dm', value: 0, formula: 100},
                    {unit: 'm(米)', key: 'm', value: 0, formula: 1000},
                    {unit: 'km(千米)', key: 'km', value: 0, formula: 10000}
                ],
                cn: [
                    {unit: '豪', key: 'cn_hao', value: 0, formula: 1 / 30},
                    {unit: '厘', key: 'cn_li', value: 0, formula: 1 / 3},
                    {unit: '分', key: 'cn_fen', value: 0, formula: 10 / 3},
                    {unit: '寸', key: 'cn_cun', value: 0, formula: 100 / 3},
                    {unit: '尺', key: 'cn_chi', value: 0, formula: 1000 / 3},
                    {unit: '丈', key: 'cn_zhang', value: 0, formula: 10000 / 3},
                    {unit: '里', key: 'cn_Li', value: 0, formula: 500000}
                ],
                navigation: [
                    {unit: 'nautical(海里)', key: 'nautical', value: 0, formula: 1852000},
                    {unit: 'xun(英寻)', key: 'xun', value: 0, formula: 1828.8}
                ],
                astronomy: [
                    {key: 'pc', unit: 'pc(秒差距 (pc)', value: 0, formula: 3.08567758 * Math.pow(10, 19)},
                    {key: 'light_year', unit: 'light_year(光年)', value: 0, formula: 9.4605284 * Math.pow(10, 18)},
                    {key: 'ae', unit: 'ae(天文单位 (AE))', value: 0, formula: 1.49597871 * Math.pow(10, 14)},
                    {key: 'light_second', unit: 'light_second(光秒)', value: 0, formula: 2.99792458 * Math.pow(10, 11)},
                    {key: 'light_minute', unit: 'light_minute(光分)', value: 0, formula: 1.79875475 * Math.pow(10, 13)}
                ],
                en_us: [
                    {key: 'in', unit: '英寸(in)', value: 0, formula: 25.4},
                    {key: 'ft', unit: '英尺(ft)', value: 0, formula: 304.8},
                    {key: 'mi', unit: '英里(mi)', value: 0, formula: 1609344},
                    {key: 'yd', unit: '码(yd)', value: 0, formula: 914.4}
                ]
            }
        },
        watch: {
            input: function () {
                this.translate()
            },
            now: function () {
                this.translate()
            },
            future: function () {
                if (this.future === 'all') {
                    this.display.clear = false;
                    this.display.all = true;
                } else {
                    this.translate();
                    this.display.clear = true;
                    this.display.all = false;
                }
            }
        },
        methods: {
            translate: function () {
                var that = this;
                var now_formula = 0;
                var future_formula = 0;
                var future_unit, now_unit;
                _.forEach(this.units, function (value, key) {
                    if (_.find(value.values, {'value': that.future}) !== undefined) {
                        future_unit = _.result(_.find(value.values, {'value': that.future}), 'text')
                    }
                    if (_.find(value.values, {'value': that.now}) !== undefined) {
                        now_unit = _.result(_.find(value.values, {'value': that.now}), 'text')
                    }
                });
                _.forIn(this.results, function (value, key) {//最小单位 mm赋值
                    var current_formula = _.find(value, {'key': that.now});
                    if (current_formula !== undefined) {
                        now_formula = _.result(current_formula, 'formula');
                    }
                    if (that.future !== 'all') {
                        var future_current_formula = _.find(value, {'key': that.future});
                        if (future_current_formula) {
                            future_formula = _.result(future_current_formula, 'formula');
                            that.display.clearData = that.input + now_unit + '=' +
                                that.input * now_formula / future_formula + future_unit
                        }
                    }
                });
                _.forIn(this.results, function (group, g_key) {
                    _.forEach(group, function (value, key) {
                        value.value = parseFloat(that.input) * now_formula / parseFloat(value.formula);
                        if (value.value > Math.pow(10, 7)) {
                            value.value = value.value.toExponential(4)
                        }
                        if (value.value < Math.pow(10, -5)) {
                            value.value = value.value.toExponential(4)
                        }
                        if (value.value < Math.pow(10,7) && value.value > Math.pow(10,-5)){
                            console.log(typeof (value.value))
                            if (typeof value.value === "string"){
                                console.log(value)
                            }
                            value.value = parseFloat(value.value.toFixed(6));
                        }
                    })
                });
            },
            reversal: function () {
                if (this.future !== 'all') {
                    var now = this.now;
                    this.now = this.future;
                    this.future = now;
                }
            }
        }
    });
</script>
</html>